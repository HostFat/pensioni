<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsione Sostenibilità Sistema Pensionistico Italiano</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { text-align: center; }
        #results { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .warning { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Previsione del Fallimento del Sistema Pensionistico Italiano</h1>
    <p>Questa pagina web fetcha dati in tempo reale da API pubbliche (Eurostat) e dal sito INPS per calcolare indicatori di sostenibilità del sistema pensionistico italiano. Basato su proiezioni ufficiali, il sistema è previsto sostenibile a lungo termine grazie alle riforme passate, ma con rischi nel medio periodo dovuti all'invecchiamento demografico.</p>
    <p>Indicatori chiave:</p>
    <ul>
        <li>Spesa pensionistica come % del PIL (da Eurostat, dataset tps00103).</li>
        <li>Old-age dependency ratio: Popolazione 65+ / Popolazione 15-64 (da Eurostat, dataset tps00198).</li>
        <li>Dati INPS: Numero pensioni vigenti e importo complessivo annuo (parsati dalla pagina news INPS più recente).</li>
        <li>Previsione semplificata: Se il ratio supera il 50% o la spesa >16% del PIL, il sistema è "a rischio" nel medio termine (basato su trend storici e proiezioni RGS/MEF fino al 2070).</li>
    </ul>
    <button onclick="fetchData()">Carica Dati Aggiornati</button>
    <div id="results"></div>

    <script>
        async function fetchData() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Caricamento dati...</p>';

            try {
                // Fetch spesa pensioni % GDP da Eurostat API (dataset: tps00103)
                const pensionExpUrl = 'https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data/tps00103?geo=IT&time=2021&time=2022&time=2023&time=2024&time=2025';
                const pensionResponse = await fetch(pensionExpUrl);
                const pensionData = await pensionResponse.json();
                const pensionYears = Object.keys(pensionData.value || {}).sort((a,b) => b - a);
                const latestPensionYear = pensionYears[0];
                let pensionPct = pensionData.value[latestPensionYear] || 'N/A';
                if (pensionPct !== 'N/A') {
                    pensionPct = pensionPct.toFixed(2);
                }

                // Fetch old-age dependency ratio da Eurostat (dataset: tps00198)
                const ratioUrl = 'https://ec.europa.eu/eurostat/api/dissemination/statistics/1.0/data/tps00198?geo=IT&time=2023&time=2024&time=2025';
                const ratioResponse = await fetch(ratioUrl);
                const ratioData = await ratioResponse.json();
                const ratioYears = Object.keys(ratioData.value || {}).sort((a,b) => b - a);
                const latestRatioYear = ratioYears[0];
                let dependencyRatio = ratioData.value[latestRatioYear] || 'N/A';
                if (dependencyRatio !== 'N/A') {
                    dependencyRatio = dependencyRatio.toFixed(2);
                }

                // Fetch INPS data from news page using a CORS proxy
                const inpsUrl = 'https://www.inps.it/it/it/inps-comunica/notizie/dettaglio-news-page.news.2025.03.osservatorio-sulle-pensioni-i-dati-2024-e-2025.html';
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(inpsUrl)}`;
                const inpsResponse = await fetch(proxyUrl);
                const inpsText = await inpsResponse.text();
                // Parse total pensioni vigenti
                const totalPensioniMatch = /totale di ([\d\.]+) pensioni vigenti/.exec(inpsText);
                const totalPensioni = totalPensioniMatch ? totalPensioniMatch[1] : 'N/A';
                // Parse importo complessivo
                const importoMatch = /importo complessivo annuo .*?pari a ([\d,]+) miliardi di euro/.exec(inpsText);
                const importoAnnuale = importoMatch ? importoMatch[1] : 'N/A';

                // Calcolo previsione semplificata basata su trend (da documenti MEF/RGS: picco 17% GDP al 2040, poi calo a 14% al 2070)
                let forecast = '';
                if (parseFloat(pensionPct) > 16 || parseFloat(dependencyRatio) > 50) {
                    forecast = '<p class="warning">Rischio elevato nel medio termine (fino al 2040): Spesa prevista al 17% del PIL, ratio demografico critico. Potenziale insostenibilità senza ulteriori riforme.</p>';
                } else {
                    forecast = '<p class="info">Sistema sostenibile a lungo termine: Spesa prevista in calo dopo il 2040 grazie a riforme (es. Fornero) e adeguamenti automatici.</p>';
                }

                // Proiezione semplice lineare per dependency ratio (assumendo crescita 1% annua basata su trend storici)
                const currentYear = new Date().getFullYear();
                const yearsTo2040 = 2040 - currentYear;
                const projectedRatio2040 = (parseFloat(dependencyRatio) * Math.pow(1.01, yearsTo2040)).toFixed(2);
                const projectedMessage = projectedRatio2040 > 60 ? '<p class="warning">Proiezione 2040: Ratio >60%, alto rischio di squilibrio.</p>' : '<p>Proiezione 2040: Sostenibile.</p>';

                resultsDiv.innerHTML = `
                    <p><strong>Spesa Pensionistica % GDP (anno ${latestPensionYear}):</strong> ${pensionPct}%</p>
                    <p><strong>Old-Age Dependency Ratio (anno ${latestRatioYear}):</strong> ${dependencyRatio}%</p>
                    <p><strong>Dati INPS (vigenti al 1° gennaio 2025):</strong></p>
                    <p>- Numero pensioni: ${totalPensioni}</p>
                    <p>- Importo complessivo annuo: ${importoAnnuale} miliardi di euro</p>
                    <p><strong>Previsione Basata su Dati:</strong> ${forecast}</p>
                    ${projectedMessage}
                    <p>Fonte: Eurostat API e sito INPS. Dati aggiornati al ${new Date().toLocaleDateString()}. Nota: Le proiezioni sono semplificate; consulta documenti ufficiali MEF/RGS per dettagli. I dati INPS sono estratti dalla pagina news; aggiornare l'URL per release future. Utilizzato proxy per bypassare CORS.</p>
                `;
            } catch (error) {
                resultsDiv.innerHTML = '<p class="warning">Errore nel caricamento dati: ' + error.message + '</p>';
            }
        }
    </script>
</body>
</html>




